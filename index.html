<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Chat App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center h-screen font-sans">

    <div class="w-full max-w-2xl h-full flex flex-col p-4">
        <div class="flex items-center justify-between border-b-2 border-gray-200 pb-4 mb-4">
             <h1 class="text-3xl font-bold text-gray-800">🔥 Firebase Chat</h1>
             <div class="text-sm text-gray-600">Your ID: <span id="userId" class="font-mono bg-gray-200 px-2 py-1 rounded"></span></div>
        </div>

        <div id="messages" class="flex-1 overflow-y-auto bg-white rounded-lg shadow-inner p-4 mb-4 space-y-4">
            </div>

        <form id="messageForm" class="flex items-center">
            <input type="text" id="messageInput" placeholder="Type your message..." autocomplete="off" class="flex-1 px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-r-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Send
            </button>
        </form>
    </div>

    <script>
        // --- START: FIREBASE CONFIGURATION ---
        // ⚠️ PASTE YOUR FIREBASE CONFIGURATION OBJECT HERE
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        // --- END: FIREBASE CONFIGURATION ---

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const messagesCollection = db.collection('messages');

        // DOM Elements
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('messageInput');
        const messagesContainer = document.getElementById('messages');
        const userIdSpan = document.getElementById('userId');

        let currentUser;

        // --- AUTHENTICATION ---
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in.
                currentUser = user;
                userIdSpan.textContent = user.uid.substring(0, 6); // Display first 6 chars of UID
            } else {
                // User is signed out. Sign in anonymously.
                auth.signInAnonymously().catch(error => {
                    console.error("Error signing in anonymously:", error);
                });
            }
        });

        // --- SEND MESSAGE ---
        messageForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const text = messageInput.value.trim();

            if (text && currentUser) {
                messagesCollection.add({
                    text: text,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    uid: currentUser.uid
                });
                messageInput.value = ''; // Clear input
            }
        });

        // --- LISTEN FOR & DISPLAY MESSAGES ---
        messagesCollection.orderBy('createdAt').onSnapshot(snapshot => {
            messagesContainer.innerHTML = ''; // Clear previous messages
            snapshot.forEach(doc => {
                const message = doc.data();
                const isCurrentUser = message.uid === (currentUser ? currentUser.uid : null);
                
                // Create message bubble
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('flex', isCurrentUser ? 'justify-end' : 'justify-start');
                
                const bubble = document.createElement('div');
                bubble.textContent = message.text;
                bubble.classList.add(
                    'max-w-xs', 'md:max-w-md', 'px-4', 'py-2', 'rounded-lg', 'shadow',
                    isCurrentUser ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'
                );

                messageDiv.appendChild(bubble);
                messagesContainer.appendChild(messageDiv);
            });
            // Auto-scroll to the latest message
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        });

    </script>

</body>
</html>
